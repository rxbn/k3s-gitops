---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: ${BASE_DOMAIN/./-}-v4
spec:
  type: dynamic
  ipSources:
    - url: https://ifconfig.me/ip
    - url: https://ipecho.net/plain
    - url: https://myip.is/ip/
    - url: https://checkip.amazonaws.com
    - url: https://api.ipify.org
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: ${BASE_DOMAIN/./-}-v6
spec:
  type: static
  address: ${METALLB_TRAEFIK_ADDRESS_POOL_V6%/128}
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: teslamate-v4
spec:
  type: dynamic
  ipSources:
    - url: https://api.hetzner.cloud/v1/servers
      requestHeaders:
        Accept: application/json
      requestHeadersSecretRef:
        name: hetzner-cloud-api-key
        namespace: cloudflare-operator
      responseJSONPath: '{.servers[?(@.name=="teslamate.srv.${BASE_DOMAIN}")].public_net.ipv4.ip}'
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: teslamate-v6
spec:
  type: dynamic
  ipSources:
    - url: https://api.hetzner.cloud/v1/servers
      requestHeaders:
        Accept: application/json
      requestHeadersSecretRef:
        name: hetzner-cloud-api-key
        namespace: cloudflare-operator
      responseJSONPath: '{.servers[?(@.name=="teslamate.srv.${BASE_DOMAIN}")].public_net.ipv6.ip}'
      responseRegex: ([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: checkmk-v4
spec:
  type: dynamic
  ipSources:
    - url: https://api.hetzner.cloud/v1/servers
      requestHeaders:
        Accept: application/json
      requestHeadersSecretRef:
        name: hetzner-cloud-api-key
        namespace: cloudflare-operator
      responseJSONPath: '{.servers[?(@.name=="checkmk.srv.${BASE_DOMAIN}")].public_net.ipv4.ip}'
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: checkmk-v6
spec:
  type: dynamic
  ipSources:
    - url: https://api.hetzner.cloud/v1/servers
      requestHeaders:
        Accept: application/json
      requestHeadersSecretRef:
        name: hetzner-cloud-api-key
        namespace: cloudflare-operator
      responseJSONPath: '{.servers[?(@.name=="checkmk.srv.${BASE_DOMAIN}")].public_net.ipv6.ip}'
      responseRegex: ([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: keycloak-v4
spec:
  type: dynamic
  ipSources:
    - url: https://api.hetzner.cloud/v1/servers
      requestHeaders:
        Accept: application/json
      requestHeadersSecretRef:
        name: hetzner-cloud-api-key
        namespace: cloudflare-operator
      responseJSONPath: '{.servers[?(@.name=="keycloak.srv.${BASE_DOMAIN}")].public_net.ipv4.ip}'
---
apiVersion: cf.containeroo.ch/v1beta1
kind: IP
metadata:
  name: keycloak-v6
spec:
  type: dynamic
  ipSources:
    - url: https://api.hetzner.cloud/v1/servers
      requestHeaders:
        Accept: application/json
      requestHeadersSecretRef:
        name: hetzner-cloud-api-key
        namespace: cloudflare-operator
      responseJSONPath: '{.servers[?(@.name=="keycloak.srv.${BASE_DOMAIN}")].public_net.ipv6.ip}'
      responseRegex: ([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))
